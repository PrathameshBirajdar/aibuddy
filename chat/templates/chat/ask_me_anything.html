<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Me Anything</title>
    <style>
        #amaChatBox {
            display: flex;
            flex-direction: column;
            height: 500px;
            overflow-y: auto;
            background: #fffdfc;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #ddd;
        }

        .msg {
            max-width: 75%;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 12px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .msg.user {
            background: #a4c8ff;
            align-self: flex-end;
        }

        .msg.bot {
            background: #f4f4f4;
            align-self: flex-start;
        }

        .msg img {
            max-width: 200px;
            border-radius: 10px;
            margin-top: 5px;
            display: block;
        }

        #amaInputBar {
            display: flex;
            margin-top: 10px;
            gap: 10px;
        }

        #amaMessage {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            outline: none;
        }

        #amaSendBtn {
            background-color: #50c878;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            cursor: pointer;
            font-weight: bold;
        }

        #amaSendBtn:hover {
            background-color: #3ca05c;
        }

        #quizOptions {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .quiz-option {
            background: #9cc7ff;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
        }

        .quiz-option:hover {
            background: #6aa5ff;
        }
    </style>
</head>

<body>
    <h2 style="text-align:center;">Ask Me Anything ðŸ¤–</h2>
    <div id="amaChatBox"></div>

    <div id="amaInputBar">
        <input type="text" id="amaMessage" placeholder="Type your question or answer..." />
        <button id="amaSendBtn">Send</button>
    </div>

    <script>
        const chatBox = document.getElementById("amaChatBox");
        const input = document.getElementById("amaMessage");
        const sendBtn = document.getElementById("amaSendBtn");

        function appendMessage(content, type = "bot") {
            const msgDiv = document.createElement("div");
            msgDiv.className = `msg ${type}`;

            if (content.startsWith("http")) {
                const img = document.createElement("img");
                img.src = content;
                msgDiv.appendChild(img);
            } else {
                msgDiv.innerHTML = content;
            }

            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function sendMessage() {
            const text = input.value.trim();
            if (!text) return;

            appendMessage(text, "user");
            input.value = "";

            const res = await fetch("/chat/api/chat/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: text,
                    name: "Buddy",
                    context: "ask_me_anything",
                }),
            });

            const data = await res.json();

            if (data.image) appendMessage(data.image, "bot");
            if (data.response) appendMessage(data.response, "bot");

            if (data.quiz_options) {
                const optionsContainer = document.createElement("div");
                optionsContainer.id = "quizOptions";
                optionsContainer.style.marginTop = "10px";

                data.quiz_options.forEach((opt) => {
                    const btn = document.createElement("button");
                    btn.className = "quiz-option";
                    btn.textContent = opt;
                    btn.onclick = () => handleQuizAnswer(opt);
                    optionsContainer.appendChild(btn);
                });

                chatBox.appendChild(optionsContainer);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        async function handleQuizAnswer(answer) {
            appendMessage(`ðŸ‘‰ My answer: ${answer}`, "user");
            const res = await fetch("/chat/api/chat/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: answer,
                    name: "Buddy",
                    context: "quiz_followup",
                }),
            });
            const data = await res.json();
            appendMessage(data.response, "bot");
        }

        sendBtn.onclick = sendMessage;
        input.addEventListener("keydown", (e) => e.key === "Enter" && sendMessage());
    </script>

</body>

</html>